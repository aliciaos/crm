

<form method="get" action="<%= url %>"  class="right filters">

    <div class="vcenter">
        Filtros:
        <input type="image" class="icon" src="/images/find.png" border="0" alt="Submit" />
    </div>

    <label>Desde:</label>
    <input type="text"
           name="searchdateafter"
           value="<%= locals.searchdateafter || '' %>"
           placeholder="dd-mm-aaaa"
           pattern="\d\d-\d\d-\d\d\d\d"
           autocomplete="off" />

    <label>Hasta:</label>
    <input type="text"
           name="searchdatebefore"
           value="<%= locals.searchdatebefore || '' %>"
           placeholder="dd-mm-aaaa"
           pattern="\d\d-\d\d-\d\d\d\d"
           autocomplete="off" />

    <br />

    <label>Cliente:</label>
    <input type="text" name="searchcustomer" value="<%= locals.searchcustomer || '' %>" placeholder="Cliente a buscar" size="40" autocomplete="off" />

    <br />

    <label>Vendedor:</label>
    <input type="text" name="searchsalesman" value="<%= locals.searchsalesman || '' %>" placeholder="Vendedor a buscar" size="40" autocomplete="off" />

    <br />

</form>



<h1> 
    Visitas: 

    <a href="/goback"><img class="icon" src="/images/back.png"></a>

    <a href="/visits/new"><img class="icon" src="/images/add.png"></a>
</h1>

<%  if (locals.paginate_control) { %>
<%- paginate_control %>
<% } %>

<table>
    <tr>
        <th>
            Cliente
        </th>
        <th>
            Vendedor
        </th>
        <th>
            Planificado
        </th>
        <th>
            Realizado
        </th>
        <th>
            Objetivos
        </th>
        <th>
            Observaciones
        </th>
        <th>
            
        </th>
    </tr> 

    <% for (var i in visits) { %> 
        <% var visit = visits[i]; %>

    <% var customerCode = visit.Customer && visit.Customer.code || ""; %>
    <% var salesmanName = visit.Salesman && visit.Salesman.name || ""; %>

        <tr>
            <td>
                <% if (customerCode) { %>
                    <%= customerCode %>
                <% } else { %>
                    <% customerCode = "SIN CLIENTE"; %>
                    <span class='toberepared'><%= customerCode %></span>
                <% } %>
            </td>
            <td>
                <% if (salesmanName) { %>
                    <%= salesmanName %>
                <% } else { %>
                    <% salesmanName = "SIN VENDEDOR"; %>
                    <span class='toberepared'><%= salesmanName %></span>
                <% } %>
            </td>
            <td>
                <%= moment(visit.plannedFor).format("DD-MM-YYYY") %>
            </td>
            <td>
            <%= !!visit.fulfilledAt ? moment(visit.fulfilledAt).format("DD-MM-YYYY") : "PENDIENTE" %>
            </td>
            <td>
                <%= visit.Targets.length %>
            </td>
            <td>
                <%= visit.notes === "" ? "No" : "Si" %>
            </td>
            <td>
                <a href="/visits/<%= visit.id %>"><img class="icon" src="/images/ver.png"></a>

                <% if (session.user && session.user.isAdmin) { %>
                    <a href="/visits/<%= visit.id %>?_method=DELETE"
                       onClick="return confirm('Â¿Seguro que quiere borrar la visita de <%= salesmanName %> a <%= customerCode %>?');"><img class="icon" src="/images/basura.png"></a>
                <% } %>
            </td>
         </tr> 
    <% } %>

</table>

